<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Тестування працездатності системи | Розробка RESTFull сервісу на KOA</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/edu-dis-labs/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="description" content="Лабораторні роботи з дисципліни "Розподілені інформаційні системи"">
    
    <link rel="preload" href="/edu-dis-labs/assets/css/0.styles.178e1a70.css" as="style"><link rel="preload" href="/edu-dis-labs/assets/js/app.3700a9c6.js" as="script"><link rel="preload" href="/edu-dis-labs/assets/js/2.d2c00dab.js" as="script"><link rel="preload" href="/edu-dis-labs/assets/js/24.9cf4e97c.js" as="script"><link rel="prefetch" href="/edu-dis-labs/assets/js/10.5d5296ab.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/11.7227b195.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/12.d9af3753.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/13.b8dd9aae.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/14.f76bc3b8.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/15.5d41688e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/16.62288e0a.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/17.49b85c6e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/18.f99339da.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/19.81b795fc.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/20.2fc292c0.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/21.3b6655ea.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/22.726d843f.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/23.df4ecd71.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/25.4d9e7944.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/26.87ff770b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/3.2c27ece5.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/4.5042fbeb.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/5.8b0efd2b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/6.aeddef27.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/7.4bdd093e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/8.e2d1a40b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/9.cce8dc66.js">
    <link rel="stylesheet" href="/edu-dis-labs/assets/css/0.styles.178e1a70.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/edu-dis-labs/" class="home-link router-link-active"><!----> <span class="site-name">Розробка RESTFull сервісу на KOA</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/edu-dis-labs/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/RomanKaplynskyi/edu-dis-labs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/edu-dis-labs/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/RomanKaplynskyi/edu-dis-labs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/edu-dis-labs/intro/" class="sidebar-link">Вступ</a></li><li><a href="/edu-dis-labs/requirements/" class="sidebar-link">Розроблення вимог до системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#основні-визначення" class="sidebar-link">Основні визначення</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#підходи-та-способи-вирішення-завдання" class="sidebar-link">Підходи та способи вирішення завдання</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#порівняльна-характеристика-існуючих-засобів-вирішення-завдання" class="sidebar-link">Порівняльна характеристика існуючих засобів вирішення завдання</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#висновки" class="sidebar-link">Висновки</a></li></ul></li><li><a href="/edu-dis-labs/design/" class="sidebar-link">Проєктування архітектури системи</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/edu-dis-labs/software/" class="sidebar-heading clickable"><span>Реалізація інформаційного та програмного забезпечення</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/edu-dis-labs/test/" aria-current="page" class="active sidebar-link">Тестування працездатності системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/test/#автоматизація-тестування-сервісу" class="sidebar-link">Автоматизація тестування сервісу</a></li></ul></li><li><a href="/edu-dis-labs/conclusion/" class="sidebar-link">Висновки</a></li><li><a href="/edu-dis-labs/api/" class="sidebar-link">API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="тестування-працездатності-системи"><a href="#тестування-працездатності-системи" class="header-anchor">#</a> Тестування працездатності системи</h1> <h2 id="автоматизація-тестування-сервісу"><a href="#автоматизація-тестування-сервісу" class="header-anchor">#</a> Автоматизація тестування сервісу</h2> <p><a href="https://chrome.google.com/webstore/detail/tabbed-postman-rest-clien/coohjcphdfgbiolnekdpbcijmhambjff" target="_blank" rel="noopener noreferrer">Tabbed Postman - REST Client<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> доволі зручний засіб для знайомства з новими веб-сервісами, але для повного тестування - занадто громіздкий.
Для тестування API нашого сервісу скористаємося тестовим фреймворком <a href="https://www.npmjs.com/package/jest" target="_blank" rel="noopener noreferrer">jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> та бібліотекою <a href="https://www.npmjs.com/package/axios" target="_blank" rel="noopener noreferrer">axios<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, яка дозволяє програмно ініціювать HTTP-запити.</p> <p>Встановимо необхідні залежності за допомогою команди:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest 
<span class="token function">npm</span> <span class="token function">install</span> --save-dev axios 
</code></pre></div><p>В файлі <code>package.json</code> додамо скрипт для тестування:</p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;koa-restful&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;В цьому розділі розміщені програмні коди.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon server&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.24.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^27.3.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.15&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@koa/cors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@koa/router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.13.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-bodyparser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-cookie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-logger&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-static&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.21&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;uuid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.3.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Тепер за допомогою команди</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token builtin class-name">test</span>
</code></pre></div><p><code>jest</code> знайде всі файли, що в назві містять <code>.test</code> та запустить тестування. Але в нас ще немає тестів.</p> <p>Модифікуємо <code>server.js</code>:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../edu-dis-labs/src/routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookie <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-cookie'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">Serve</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>staticPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">** EDU JACE server starts at port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> server
</code></pre></div><p>Тепер модуль <code>server.js</code> експортує змінну <code>server</code>, яку ми будемо використовувати в тесті для програмної зупинки сервера.</p> <p>Створимо каталог для тестів <code>./test</code>, та в ньому - файл <code>./test/rest-api.test.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../src/server&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> endpoint <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8080/presidents&quot;</span>

<span class="token function">afterAll</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;read entities&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;read complete collection without options&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;read one entity by id from params&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>endpoint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;Barrac Obama&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;read one entity by id from query&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>endpoint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?id=1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;Barrac Obama&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;read empty by unresolved id&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>endpoint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?id=5</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;test CRUD&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> entityId
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;create, update, delete workflow&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span><span class="token string">&quot;George Washington&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                entityId <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id
                <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;George Washington&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>endpoint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entityId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    name<span class="token operator">:</span><span class="token string">&quot;George Washington&quot;</span><span class="token punctuation">,</span>
                    photo<span class="token operator">:</span><span class="token string">&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Gilbert_Stuart_Williamstown_Portrait_of_George_Washington.jpg/240px-Gilbert_Stuart_Williamstown_Portrait_of_George_Washington.jpg&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>entityId<span class="token punctuation">)</span>
                <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>endpoint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entityId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>entityId<span class="token punctuation">)</span>
                <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">resp</span> <span class="token operator">=&gt;</span> <span class="token function">expect</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Імпортуємо змінну <code>server</code> з нашого сервера (зараз сервер запускається на порту 8080). Імпортуємо <code>axios</code>. Визначаємо посилання на кінцеву точку нашого сервісу та розпочинаємо тестування.</p> <p>По-перше, за допомогою <code>afterAll</code> визначаємо обробник , який <code>jest</code> запустить після виконання всіх тестів (нам потрібно зупинити сервер).</p> <p>По-друге, за допомогою <code>describe</code> визначаємо два набори тестів:</p> <ul><li>для перевірки зчитування даних (<code>read entities</code>);</li> <li>для перевірки CRUD-інтерфейса в робочому процесі (<code>test CRUD</code>).</li></ul> <p>Набір тестів <code>read entities</code> складається з 5 простих тестів. Оскільки операція виконання HTTP-запитів є асинхронною, то <code>callback</code>, який визначається в функції <code>test</code>, повинен повертати <code>promise</code>. Цей <code>promise</code>, наприклад для тесту <code>read complete collection without options</code>, формується наступним чином.</p> <ol><li>За допомогою <code>axios</code> здійснюємо GET-запит за адресою <a href="http://localhost:8080/presidents" target="_blank" rel="noopener noreferrer">http://localhost:8080/presidents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (<code>axios.get</code> повертає <code>promise</code>)</li> <li>Визначаємо для цього промісу обробник <code>then</code>, який активується, коли проміс спрацьовує (<code>axios.get</code> повертає результат запиту). Обробник <code>then</code> також повертає <code>promise</code>.</li> <li>В цьому обробнику за допомогою <code>expect(&lt;testedValue&gt;).toBe(&lt;expectedValue&gt;)</code> перевіряємо, що довжина колекції дорівнює 3. тобто ми зчитуємо всю колекцію даних.</li></ol> <p>Аналогічно побудовані інші тести з цього набору.</p> <p>Тестовий набір <code>test CRUD</code> містить один тест, який реалізує наступний робочий процес.</p> <ol><li>Створюється новий примірник даних. Його унікальний ідентифікатор запам'ятовується в змінній <code>entityId</code>, яка використовується для перевірки результатів інших операцій.</li> <li>Зчитується вся колекція, перевіряється її довжина.</li> <li>Примірник даних оновлюється.</li> <li>Він зчитується та перевіряється.</li> <li>Примірник даних видаляється.</li> <li>Знову зчитується вся колекція та перевіряється її довжина.</li></ol> <p>Результати тестування нашого сервісу наведені нижче.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>PS D:<span class="token punctuation">\</span>edu-dis-labs<span class="token operator">&gt;</span> <span class="token function">npm</span> <span class="token builtin class-name">test</span>

<span class="token operator">&gt;</span> dis-edu@2.1.0 <span class="token builtin class-name">test</span>
<span class="token operator">&gt;</span> jest

  console.log
    ** EDU JACE server starts at port <span class="token number">8080</span>

      at Object.<span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span>src/server.js:14:52<span class="token punctuation">)</span>

 PASS  test/rest-api.test.js
  <span class="token builtin class-name">read</span> entities
    √ <span class="token builtin class-name">read</span> complete collection without options <span class="token punctuation">(</span><span class="token number">31</span> ms<span class="token punctuation">)</span>
    √ <span class="token builtin class-name">read</span> one entity by <span class="token function">id</span> from params <span class="token punctuation">(</span><span class="token number">3</span> ms<span class="token punctuation">)</span>
    √ <span class="token builtin class-name">read</span> one entity by <span class="token function">id</span> from query <span class="token punctuation">(</span><span class="token number">2</span> ms<span class="token punctuation">)</span>
    √ <span class="token builtin class-name">read</span> empty by unresolved <span class="token function">id</span> <span class="token punctuation">(</span><span class="token number">2</span> ms<span class="token punctuation">)</span>
  <span class="token builtin class-name">test</span> CRUD
    √ create, update, delete workflow <span class="token punctuation">(</span><span class="token number">20</span> ms<span class="token punctuation">)</span>

Test Suites: <span class="token number">1</span> passed, <span class="token number">1</span> total
Tests:       <span class="token number">5</span> passed, <span class="token number">5</span> total
Snapshots:   <span class="token number">0</span> total
Time:        <span class="token number">0.734</span> s, estimated <span class="token number">1</span> s
Ran all <span class="token builtin class-name">test</span> suites.                        
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Останнє оновлення:</span> <span class="time">11/24/2021, 4:51:27 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/edu-dis-labs/software/restfull-services.html" class="prev">
        RESTfull сервіси
      </a></span> <span class="next"><a href="/edu-dis-labs/conclusion/">
        Висновки
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/edu-dis-labs/assets/js/app.3700a9c6.js" defer></script><script src="/edu-dis-labs/assets/js/2.d2c00dab.js" defer></script><script src="/edu-dis-labs/assets/js/24.9cf4e97c.js" defer></script>
  </body>
</html>
