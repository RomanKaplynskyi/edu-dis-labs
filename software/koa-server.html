<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Розроблення веб-сервера за допомогою KOA | Розробка RESTFull сервісу на KOA</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/edu-dis-labs/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="description" content="Лабораторні роботи з дисципліни "Розподілені інформаційні системи"">
    
    <link rel="preload" href="/edu-dis-labs/assets/css/0.styles.178e1a70.css" as="style"><link rel="preload" href="/edu-dis-labs/assets/js/app.3700a9c6.js" as="script"><link rel="preload" href="/edu-dis-labs/assets/js/2.d2c00dab.js" as="script"><link rel="preload" href="/edu-dis-labs/assets/js/22.726d843f.js" as="script"><link rel="prefetch" href="/edu-dis-labs/assets/js/10.5d5296ab.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/11.7227b195.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/12.d9af3753.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/13.b8dd9aae.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/14.f76bc3b8.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/15.5d41688e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/16.62288e0a.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/17.49b85c6e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/18.f99339da.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/19.81b795fc.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/20.2fc292c0.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/21.3b6655ea.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/23.df4ecd71.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/24.9cf4e97c.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/25.4d9e7944.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/26.87ff770b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/3.2c27ece5.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/4.5042fbeb.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/5.8b0efd2b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/6.aeddef27.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/7.4bdd093e.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/8.e2d1a40b.js"><link rel="prefetch" href="/edu-dis-labs/assets/js/9.cce8dc66.js">
    <link rel="stylesheet" href="/edu-dis-labs/assets/css/0.styles.178e1a70.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/edu-dis-labs/" class="home-link router-link-active"><!----> <span class="site-name">Розробка RESTFull сервісу на KOA</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/edu-dis-labs/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/RomanKaplynskyi/edu-dis-labs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/edu-dis-labs/" class="nav-link">
  Початок
</a></div> <a href="https://github.com/RomanKaplynskyi/edu-dis-labs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/edu-dis-labs/intro/" class="sidebar-link">Вступ</a></li><li><a href="/edu-dis-labs/requirements/" class="sidebar-link">Розроблення вимог до системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#основні-визначення" class="sidebar-link">Основні визначення</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#підходи-та-способи-вирішення-завдання" class="sidebar-link">Підходи та способи вирішення завдання</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#порівняльна-характеристика-існуючих-засобів-вирішення-завдання" class="sidebar-link">Порівняльна характеристика існуючих засобів вирішення завдання</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/requirements/#висновки" class="sidebar-link">Висновки</a></li></ul></li><li><a href="/edu-dis-labs/design/" class="sidebar-link">Проєктування архітектури системи</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/edu-dis-labs/software/" class="sidebar-heading clickable router-link-active open"><span>Реалізація інформаційного та програмного забезпечення</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/edu-dis-labs/software/koa-server.html" aria-current="page" class="active sidebar-link">Розроблення веб-сервера за допомогою KOA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#підготовлення-проекту" class="sidebar-link">Підготовлення проекту</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#фаилова-структура" class="sidebar-link">Файлова структура</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#встановлення-залежностеи" class="sidebar-link">Встановлення залежностей</a></li></ul></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#конфігурування-сервера" class="sidebar-link">Конфігурування сервера</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#першии-запуск" class="sidebar-link">Перший запуск</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#налаштування-проміжного-пз-доступ-до-статичних-фаилів" class="sidebar-link">Налаштування проміжного ПЗ. Доступ до статичних файлів</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#оброблення-запитів" class="sidebar-link">Оброблення запитів</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/koa-server.html#оброблення-параметрів-запиту" class="sidebar-link">Оброблення параметрів запиту</a></li></ul></li><li><a href="/edu-dis-labs/software/restfull-services.html" class="sidebar-link">RESTfull сервіси</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#підготовлення-проекту" class="sidebar-link">Підготовлення проекту</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#розроблення-контролера" class="sidebar-link">Розроблення контролера</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#розроблення-роутера" class="sidebar-link">Розроблення роутера</a></li><li class="sidebar-sub-header"><a href="/edu-dis-labs/software/restfull-services.html#перевірка-працездатності-сервісу" class="sidebar-link">Перевірка працездатності сервісу</a></li></ul></li></ul></section></li><li><a href="/edu-dis-labs/test/" class="sidebar-link">Тестування працездатності системи</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/edu-dis-labs/test/#автоматизація-тестування-сервісу" class="sidebar-link">Автоматизація тестування сервісу</a></li></ul></li><li><a href="/edu-dis-labs/conclusion/" class="sidebar-link">Висновки</a></li><li><a href="/edu-dis-labs/api/" class="sidebar-link">API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="розроблення-веб-сервера-за-допомогою-koa"><a href="#розроблення-веб-сервера-за-допомогою-koa" class="header-anchor">#</a> Розроблення веб-сервера за допомогою KOA</h1> <h2 id="підготовлення-проекту"><a href="#підготовлення-проекту" class="header-anchor">#</a> Підготовлення проекту</h2> <p>Для початку роботи необхідно встановити <a href="https://nodejs.org/uk/" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> та <a href="https://www.npmjs.com/package/nodemon" target="_blank" rel="noopener noreferrer">nodemon<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Перевірити це встановлення за допомогою команд:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>node --version                                                                                 
v16.10.0                                                                                                                                 
                                                                                                                                         
<span class="token function">npm</span> --version                                                                                  
<span class="token number">7.24</span>.0     
</code></pre></div><p>На наступному кроці треба створити каталог проекту, перейти в нього та ініціювати проект за допомогою команди:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> init
</code></pre></div><h3 id="фаилова-структура"><a href="#фаилова-структура" class="header-anchor">#</a> Файлова структура</h3> <p>Після цього, створити наступну файлову структуру:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├───assets                                                                                                                               
├───models                                                                                                                               
├───routes
└── package.json             
</code></pre></div><p>Призначення каталогів:</p> <ul><li><strong>assets</strong> - статичні файли;</li> <li><strong>models</strong> - файли, що експортують моделі даних;</li> <li><strong>routes</strong> - файли, що експортують обробники запитів.</li></ul> <h3 id="встановлення-залежностеи"><a href="#встановлення-залежностеи" class="header-anchor">#</a> Встановлення залежностей</h3> <p>Встановіть необхідні для роботи пакети:</p> <div class="language- extra-class"><pre class="language-text"><code>npm install koa
npm install @koa/cors
npm install koa-router
npm install koa-bodyparser
npm install koa-logger
npm install koa-static
npm install koa-bodyparser
npm install koa-cookie
</code></pre></div><p>Встановлені залежності будуть додані в файл <code>package.json</code>, який повинен мати наступний вигляд:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;koa-getting-started&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;В цьому розділі розміщені програмні коди.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.15&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@koa/cors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@koa/router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.13.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-bodyparser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-cookie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-logger&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-static&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>В секцію <code>scripts</code> додамо скрипти для запуску сервера в <code>production</code> та <code>development</code> режимах</p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;koa-getting-started&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;В цьому розділі розміщені програмні коди.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon server&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.15&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@koa/cors&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@koa/router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.13.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-bodyparser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-cookie&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-logger&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;koa-static&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="конфігурування-сервера"><a href="#конфігурування-сервера" class="header-anchor">#</a> Конфігурування сервера</h2> <p>Необхідність модуля конфігурування обумовлена бажанням швидко переналаштовувати наш сервер. При цьому можна використовувати змінні середовища, доступ до яких здійснюється за допомогою об'єкту <code>process.env.&lt;env variable name&gt;</code>. Так, наприклад при розгортанні на хмарних платформах PAAS зазвичай здійснюється динамічне призначення порта (системна змінна <code>PORT</code>), на якому повинен бути запущений сервер. З іншого боку, при розробці сервера на локальному комп'ютері простіше зафіксувати конкретний порт ( в прикладі - 8080 ).</p> <p>Таким чином, якщо існує системна змінна <code>process.env.PORT</code>, тоді сервер запускаємо на цьому порту, інакше (режим розробки на локальному комп'ютері)  - на порту 8080.</p> <p>Створимо файл  <code>config.js</code> з наступним кодом:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    server<span class="token operator">:</span><span class="token punctuation">{</span>
        port<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
        staticPath<span class="token operator">:</span> <span class="token string">&quot;./assets&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="першии-запуск"><a href="#першии-запуск" class="header-anchor">#</a> Перший запуск</h2> <p>Створимо файл <code>server.js</code> з такими рядками:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">** EDU JACE server starts at port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Ми імпортуємо встановлену за допомогою <code>npm</code> бібліотеку <a href="https://koajs.com/" target="_blank" rel="noopener noreferrer">koa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, а також наш файл конфігурації, створюємо примірник сервера та запускаємо його на відповідному до системного оточення порту. Після запуску сервера виводимо на консоль повідомлення про те, що сервер запущений.</p> <p>Запустимо сервер за допомогою команди  <code>npm run dev</code> та отримаємо в консолі наступний текст:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run dev

<span class="token operator">&gt;</span> koa-getting-started@1.0.0 dev
<span class="token operator">&gt;</span> nodemon server

<span class="token punctuation">[</span>nodemon<span class="token punctuation">]</span> <span class="token number">2.0</span>.15
<span class="token punctuation">[</span>nodemon<span class="token punctuation">]</span> to restart at any time, enter <span class="token variable"><span class="token variable">`</span>rs<span class="token variable">`</span></span>
<span class="token punctuation">[</span>nodemon<span class="token punctuation">]</span> watching path<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: *.*
<span class="token punctuation">[</span>nodemon<span class="token punctuation">]</span> watching extensions: js,mjs,json
<span class="token punctuation">[</span>nodemon<span class="token punctuation">]</span> starting <span class="token variable"><span class="token variable">`</span>node server.js<span class="token variable">`</span></span>
** EDU JACE server starts at port <span class="token number">8080</span>
</code></pre></div><p>Бачимо, що при запуску <code>npm run dev</code>  активується виклик <code>nodemon server</code> та наш сервер запускається на порту 8080 в оточенні  <code>nodemon</code>, який забезпепує &quot;гаряче перезавантаження&quot; (тобто ми працюємо на локальному комп'ютері).</p> <p>Тепер в браузері робимо запит за адресою <a href="http://localhost:8080">http://localhost:8080</a>, та маємо наступну відповідь від сервера:</p> <center><img src="/1.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <p>Наш сервер - запущений, але не обробляє запитів (принаймні типу <code>GET</code>). Якби запуск не вдався - сторінка б не завантажилась.</p> <h2 id="налаштування-проміжного-пз-доступ-до-статичних-фаилів"><a href="#налаштування-проміжного-пз-доступ-до-статичних-фаилів" class="header-anchor">#</a> Налаштування проміжного ПЗ. Доступ до статичних файлів</h2> <p>KOA, по суті, являє собою інструмент серійного виклику функцій проміжної обробки певних отриманих даних та запитів.</p> <p>Функції проміжної обробки (middleware) - це функції, які мають доступ до об'єкту запиту <code>request</code>, об'єкту відповіді <code>response</code> і наступної функції проміжної обробки <code>next</code> в циклі оброблення запиту.
Функції проміжної обробки можуть виконувати такі завдання:</p> <ul><li>Виконання будь-якого коду.</li> <li>Внесення змін до об'єкти запитів і відповідей.</li> <li>Завершення циклу &quot;запит-відповідь&quot;.</li> <li>Виклик наступної функції тимчасової роботи з стека.</li></ul> <p>Якщо поточна функція проміжної обробки завершує цикл &quot;запит-відповідь&quot;, вона повинна викликати <code>next()</code> для передачі управління наступної функції проміжної обробки. В іншому випадку запит зависне.</p> <center style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);padding:1em;"><img src="https://www.plantuml.com/plantuml/svg/TP7B2i8m44NtynMpLB01arrHAVWbiPb5e4rZCiNwzoO-eAtfSWxtde6P9h8EFFOTw9Q7WDVEacFm2ThMUkqOjVUBkRV6TFJGWOuRN6vm1V3nOtN9sXe3tKUA36d8RAQkiUNfW8ucXXbUfTx5KrKjcxcqs_zBPLagLwc2L6vBLLcgIYbn6ymJpoY4A2nHl-ja_3rFz8EB10qvavxq0W00" alt="uml diagram"></center> <p>Однією з вбудованих функцій проміжної обробки є функція оброблення запитів до статичного контенту за допомогою інструмента <code>koa-static</code>, яка дозволяє налаштувати доступ до статичних файлів.</p> <p>Вдосконалимо наш сервер:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-static&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>staticPath<span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">** EDU JACE server starts at port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Для <code>koa-static</code> необхідно вказати шлях до статичних файлів. В даному випадку, цей шлях записаний в <code>config.server.staticPath</code> (значення <code>&quot;./assets&quot;</code>)</p> <p>В каталозі <code>./assets</code> створимо файл <code>index.html</code>:</p> <div class="language-html extra-class"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span> EDU JACE server <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span> 
</code></pre></div><p>Перезавантажимо сторінку за адресою <a href="http://localhost:8080">http://localhost:8080</a>. Побачимо відповідь сервера:</p> <center><img src="/2.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <h2 id="оброблення-запитів"><a href="#оброблення-запитів" class="header-anchor">#</a> Оброблення запитів</h2> <p>Маршрутизація визначає, як сервер відповідає на клієнтський запит до конкретної адреси (end point), яким є URI (або шлях), і певного методу запиту HTTP (GET, POST і т.п.).</p> <p>Кожен маршрут може мати одну або кілька функцій обробки, які виконуються при зіставленні маршруту.</p> <p>KOA підтримує всі методи маршрутизації, що відповідають методам стандартним HTTP (get, post, put, head, delete, options, trace, copy, lock, mkcol, move, purge, propfind, proppatch, та багато інших).</p> <p>Шляхи маршрутів можуть бути рядками, шаблонами рядків або регулярними виразами:</p> <ul><li><code>/</code> - рядок, що позначає кореневий маршрут;</li> <li><code>/about</code> - рядок, що позначає маршрут <code>/about</code> (наприклад, <a href="http://localhost:8080/about" target="_blank" rel="noopener noreferrer">http://localhost:8080/about<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>);</li> <li><code>/ab?cd</code> - шаблон рядка, в якому є необов'язкове включення <code>b</code> (<code>acd</code>,<code>abcd</code>);</li> <li><code>/ab+cd</code> - шаблон рядка, в якому є одне або декілька включень <code>b</code> (<code>abcd</code>,<code>abbcd</code>,<code>abbbcd</code>, ...);</li> <li><code>/ab*cd</code> - шаблон рядка, в якому є будь-яка комбінація символів після <code>b</code> (<code>abcd</code>,<code>abxcd</code>,<code>ab123cd</code>, ...);</li> <li><code>/a/</code> - регулярний вираз, який відповідає рядку з літерою <code>a</code>;</li> <li><code>/.*fly$/</code> - регулярний вираз, який відповідає рядку, якій закінчується на <code>fly</code>.</li></ul> <p>Об'єкт <code>Router</code> являє собою ізольований екземпляр проміжного програмного забезпечення і маршрутів. Ви можете сприймати це як “міні-застосунок”, здатний виконувати лише проміжне програмне забезпечення та функції маршрутизації. Для використання маршрутизації необхідно лише підключити інструмент <code>koa-router</code> та створити новий екземпляр цього класу. Ви можете використовувати його як аргумент для <code>app.use()</code>.</p> <p>Після того як ви створили об'єкт маршрутизатора, ви можете додати проміжний шар і HTTP метод маршрутів (наприклад get, put, post, і так далі) до нього.</p> <p>Уявімо, що наш сервер буде надавати доступ до даних про президентів Сполучених Штатів.</p> <p>По-перше, змоделюємо сховище даних. Для цього в каталозі <code>./models</code> створимо файл <code>presidents.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Barrac Obama&quot;</span><span class="token punctuation">,</span>
        photo<span class="token operator">:</span> <span class="token string">&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/President_Barack_Obama.jpg/274px-President_Barack_Obama.jpg&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Donald Trump&quot;</span><span class="token punctuation">,</span>
        photo<span class="token operator">:</span> <span class="token string">&quot;https://upload.wikimedia.org/wikipedia/commons/5/56/Donald_Trump_official_portrait.jpg&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;Joe Biden&quot;</span><span class="token punctuation">,</span>
        photo<span class="token operator">:</span> <span class="token string">&quot;https://upload.wikimedia.org/wikipedia/commons/6/68/Joe_Biden_presidential_portrait.jpg&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>По-друге, в каталозі <code>./routes</code> створимо файл <code>index.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Presidents <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/presidents&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token function-variable function">getPresidents</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> Presidents
<span class="token punctuation">}</span>

router
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/presidents&quot;</span><span class="token punctuation">,</span> getPresidents<span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div><p>Створюємо примірник маршрутизатора (<code>Router</code>), імпортуємо нашу модель (<code>Presidents</code>), визначаємо функцію оброблення запиту (<code>getPresidents</code>), задаємо для <code>router</code> обробник, який відповідає шляху <code>/presidents</code> та експортуємо <code>router</code>.</p> <p>Останнє, в файлі <code>server.js</code>підключаємо <code>router</code> та налаштовуємо маршрутизатор:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-static&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">Serve</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>staticPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">** EDU JACE server starts at port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Таким чином, наш сервер має обробник запитів за шляхом <a href="http://localhost:8080/api/presidents" target="_blank" rel="noopener noreferrer">http://localhost:8080/api/presidents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. В браузері звернемося за цією адресою і отримаємо відповідь:</p> <center><img src="/3.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <h2 id="оброблення-параметрів-запиту"><a href="#оброблення-параметрів-запиту" class="header-anchor">#</a> Оброблення параметрів запиту</h2> <p>Додаткові параметри запиту можна передавати декількома способами:</p> <ul><li>за допомогою частини шляху;</li> <li>за допомогою <code>queryString</code>;</li> <li>за допомогою <code>body</code>;</li> <li>за допомогою  <code>cookie</code>.</li></ul> <p>Якщо в якості шляху використовувати спеціальний шаблон з параметрами <code>/prePath/:param1/:param2/postPath</code>, тоді доступ до параметрів запиту (<code>param1</code>, <code>param2</code>) може здійснюватися за допомогою <code>query.params</code>.</p> <p><code>QueryString</code> є частиною уніфікованого покажчика ресурсу (URL) , який присвоює значення зазначених параметрів. Рядок запиту зазвичай включає поля, додані до базової URL-адреси веб-браузером або іншим клієнтським додатком.
Типова URL-адреса, що містить <code>queryString</code>, така: <a href="https://example.com/over/there?name=ferret" target="_blank" rel="noopener noreferrer">https://example.com/over/there?name=ferret<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. В цьому випадку, шлях - це <code>/over/there</code>, а  <code>queryString</code> - <code>name=ferret</code>. Знак питання використовується як роздільник і не є частиною <code>query</code>. Доступ до параметрів, які передані через <code>queryString</code> здійснюється за допомогою <code>response.query</code>
В запитах <code>POST</code>,<code>PUT</code> та інших (окрім <code>GET</code>) можна використати тіло запиту (<code>body</code>) для передачі додаткових атрибутів. Коли ви передаєте атрибути в <code>body</code>, ви передаєте атрибути як частину об'єкта, описаного як <code>json</code>.
Для зручності оброблення <code>body</code> використовують спеціальне middleware <a href="https://www.npmjs.com/package/body-parser" target="_blank" rel="noopener noreferrer">body-parser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, яке аналізує <code>body</code> у проміжному програмному забезпеченні перед вашими обробниками, доступними в <code>req.body</code>. Цей модуль забезпечує наступні аналізатори:</p> <ul><li>Парсер тіла JSON</li> <li>Аналізатор сирого тіла</li> <li>Синтаксичний розбір тексту тексту</li> <li>Синтаксичний аналізатор форми, кодований URL-адресою
<code>bodyParser</code> надає різні способи створення проміжного програмного забезпечення. Усі проміжні засоби заповнюватимуть <code>req.body</code>, коли заголовок запиту <code>Content-Type</code> відповідає <code>type</code> параметру, або порожнім об’єктом ( {}), якщо <code>Content-Type</code> не було зіставлено або сталася помилка. Наприклад, <code>bodyParser.json</code> повертає проміжне програмне забезпечення, яке лише аналізує <code>json</code> і переглядає запити лише там, де <code>Content-Type</code>відповідає цій опції (<code>application/json</code>). Цей аналізатор приймає будь-яке кодування Unicode тіла та підтримує автоматичне розгортання gzip та deflate кодування.
<code>HTTP-cookie</code> - у комп'ютерній термінології поняття, яке використовується для опису інформації у вигляді текстових або бінарних даних, отриманих від веб-сайту на веб-сервері, яка зберігається у клієнта, тобто браузера, а потім відправлена на той самий сайт, якщо його буде повторно відвідано. Таким чином веб-сервер помічає браузер користувача при відвідуванні. Кукі створюються за ініціативою скриптового сценарію на стороні веб-браузера. При наступному візиті сервер буде знати, що користувач вже тут був. За допомогою кукі-технології можна вивчити вподобання відвідувача. Кукі є одним із найточніших засобів визначення унікального користувача. Для зручності оброблення <code>cookies</code> використовують спеціальне middleware <a href="https://www.npmjs.com/package/cookie-parser" target="_blank" rel="noopener noreferrer">cookie-parser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, яке аналізує Cookie заголовок та заповнює <code>req.cookies</code> об’єктом, який закріплений за іменами файлів cookie.
Для перевірки способів передачі параметрів в запитах, доповнемо файл <code>./routes/index.js</code>:</li></ul> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Presidents <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../models/presidents&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token function-variable function">getPresidents</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> Presidents
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">echoRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    param<span class="token operator">:</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>param<span class="token punctuation">,</span>
    queryString<span class="token operator">:</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">,</span>
    body<span class="token operator">:</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">,</span>
    cookie<span class="token operator">:</span> ctx<span class="token punctuation">.</span>cookie
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

router
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/presidents&quot;</span><span class="token punctuation">,</span> getPresidents<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/echo/:param&quot;</span><span class="token punctuation">,</span> echoRequest<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/echo/:param&quot;</span><span class="token punctuation">,</span> echoRequest<span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div><p>Визначаємо новий обробник запитів <code>echoRequest</code>, який у відповіді повертає параметри, передані в запиті. Потім назначаємо цей обробник на запити <code>GET</code> та <code>POST</code> за шляхом <code>/echo/:param</code> (<code>param</code> - параметр запиту, як частина шляху).</p> <p>Налагодим необхідне middleware в файлі <code>server.js</code>:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../edu-dis-labs/src/routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookie <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-cookie'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">Serve</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>staticPath<span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">** EDU JACE server starts at port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>В браузері здійснимо запит за адресою <a href="http://localhost:8080/api/echo/1?name=Barrac&amp;isCurrent=true" target="_blank" rel="noopener noreferrer">http://localhost:8080/api/echo/1?name=Barrac&amp;isCurrent=true<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <center><img src="/5.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center> <p>Як бачимо, <code>body</code> - це пустий об'єкт, тому що в запитах <code>GET</code> <code>body</code> не підтримується.</p> <p>Для реалізації запиту <code>POST</code> скористаємося розширенням <a href="https://chrome.google.com/webstore/detail/tabbed-postman-rest-clien/coohjcphdfgbiolnekdpbcijmhambjff" target="_blank" rel="noopener noreferrer">Tabbed Postman - REST Client<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> для браузера Chrome:</p> <center><img src="/4.jpg" style="border-radius:4px;border:1px solid #cfd7e6;box-shadow:0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);"></center></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Останнє оновлення:</span> <span class="time">12/3/2021, 11:13:51 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/edu-dis-labs/design/" class="prev">
        Проєктування архітектури системи
      </a></span> <span class="next"><a href="/edu-dis-labs/software/restfull-services.html">
        RESTfull сервіси
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/edu-dis-labs/assets/js/app.3700a9c6.js" defer></script><script src="/edu-dis-labs/assets/js/2.d2c00dab.js" defer></script><script src="/edu-dis-labs/assets/js/22.726d843f.js" defer></script>
  </body>
</html>
